\chapter{Further customization}

\section{Alternative \LaTeX{} compilers}

During the years, the preferred output format of \TeX{} has changed:
\begin{enumerate}
\item The original implementation of \TeX{} produced DVI~files
    -- this was a device-independent format that could be processed into commands
    to be sent to the printer or photo\-type\-setting machine.
\item Simultaneously in the 1980s, Adobe developed the PostScript format.
    PostScript is a language for expressing complex drawing commands to printers.%
\footnote{Processing drawing commands requires processing power and memory.
The original Apple laser printers were \emph{more powerful} than the
Macintosh computers used to lay out the documents!}
    It became the universal standard,
    and in the 1990s a lot of \TeX{} documents were put online as \verb|.ps| files.
    These files were produced from DVI~files by a converter.
\item PDF (Portable Document Format), also by Adobe,
    was created in the 1990s and has become the dominant standard.
    PDF encapsulates a subset of PostScript, image data, and metadata about the document.
\end{enumerate}

Originally, PDF~files were produced by first converting DVI to PostScript and then to PDF.
In early 2000s, a new implementation of \TeX{} appeared: \prg{pdftex}.
It produces PDF~files directly and supports some special features of the format:
For example, the \pkg{pdflscape} package can tell the PDF reader
to display a landscape page in rotated mode.

\begin{technote}
The only difference between \textbf{pdftex} and \textbf{pdflatex}
is whether the \LaTeX{} macros are automatically loaded.
These notes make no effort at being consistent with the names.
\end{technote}


Another development was with the character sets.
Original \TeX{} used 7~bits per character, because 128~characters is enough for anybody
(that is, anybody writing in English).
In the 1980s, this was recognized as unsustainable,
so the character set was \emph{doubled} into 8~bits.
Any further extensions to that are based on swapping fonts on the fly.

This limitation applies also to \prg{pdftex},
but in the current\footnote{Read: past 20~years.} age of Unicode there are now alternatives.
The two major alternative compilers are
\begin{itemize}
\item \prg{luatex}, which is based on \prg{pdftex} source code.
    It uses Unicode as its native character set.
    As the name suggests, extension packages can be also written in the Lua programming language.
    Some packages like TikZ use the Lua support for a speed boost.
\item \prg{xetex} is an independent Unicode-native development
    that uses a completely different PDF backend.
    It produces a bit smaller PDF files than \prg{luatex},
    but it is less actively maintained.
\end{itemize}

Both of these ``modern'' engines support loading arbitrary OpenType fonts
with the \pkg{fontspec} package, unlike \prg{pdftex}.
(This is discussed in \Cref{sec:typefaces}.)
The native use of Unicode also means that letters like `ä'
really are output as the glyph `ä',
not \texttt{\textasciidieresis a} superimposed on top of each other
-- something you only see when copying text from a PDF~file.

\begin{practices}
Based on the discussion above,
it would be natural to suggest always using \prg{luatex}.
For personal writing, either of the Unicode engines should be the first choice.

Alas, arXiv and many publishers still use \prg{pdftex} in their pipeline.
This means that we are still stuck with making our articles \prg{pdftex}-compatible.
Hopefully the situation will change soon enough.
\end{practices}



%
%
%
\section{Accessibility of documents}

The PDF file format is principally a set of instructions to a printer:
draw a curve here, another there, and so on.
This poses a problem for accessibility.
Some examples of accessibility issues are:
%
\begin{itemize}
\item Can a ``screen reader'' program read the document aloud for a blind person?
\item Can a visually impaired person increase the color contrast on graphics?
\item Can the text from the document be copy-pasted into another program?
\end{itemize}
%
Note that the last point might not sound like an accessibility issue,
but it is caused and solvable by the same reasons.

There are three layers of accessibility work going on:
%
\begin{enumerate}
\item The PDF format can include semantic metadata about the document contents.
    \LaTeX{} is increasingly better at writing this metadata,
    but it might require you to opt in to the new behavior.
\item \LaTeX{} can be compiled into another format, such as HTML web page.
    This approach is increasingly used by major publishers and arXiv.
    It requires you to use a sensible subset of \LaTeX.
\item Source code is very accessible to a screen reader program;
    a well-written \verb|.tex| file is a good workaround.
    This still requires you to write clean code.
\end{enumerate}
%
We will briefly explore each of these layers below.

\begin{practices}
Accessibility is for everybody.
Most people benefit from some accommodations at some point in their life.
Even without an ``obvious'' disability, think about reading your document
\begin{itemize}
    \item on an ebook reader with grayscale screen (visual impairment),
    \item on a mobile phone in bright sunlight (ditto), or
    \item by a sleep-deprived parent between meetings (cognitive impairment).
\end{itemize}
Not all accessibility issues have technological solutions
-- they also require you to think about how you present your message.
A complicated figure is hard to read, no matter the technology used to produce it.
\end{practices}


%
%
\subsection{PDF accessibility}

This is the core accessibility work done by the \LaTeX{} team during the last few years.
The goal is to embed semantic metadata about the document into the PDF format.
A lot of the semantics is in the \verb|.tex| source in form of sectioning commands and such.

The translation is hampered by the need to rewrite \LaTeX{} internals without breaking compatibility,
and all the abuse of commands to get semantically incorrect but visually good results.

To enable PDF metadata, you should do the following steps:
\begin{itemize}
\item Use a modern \LaTeX{} compiler like LuaL\prg{luatex} or \prg{xetex}.
    Since \prg{luatex} is more actively maintained, it is preferable.
\item Add \cmd{DocumentMetadata} as the first line (before \verb|\documentclass|) of the code.
\item Load the \pkg{hyperref} package.
\item Consider loading the \pkg{unicode-math} package
    (and remove other mathematics symbol and font packages;
    see page~\pageref{rem:math unicode}).
\end{itemize}

\begin{warning}
Since some behavior changes subtly,
you should take these into use only in new projects
and only when everybody involved (including the publisher) uses a Unicode-native \LaTeX{} pipeline.

Be extra careful with checking the output when converting old projects,
or if you need to compile the project with both old and new toolsets.
\end{warning}

\begin{warning}
As of April~2024, arXiv \emph{does not} use Unicode-native \LaTeX{} tools;
their process involves \prg{pdftex}.
For arXiv submissions, follow the next section instead.
\end{warning}

The \cmd{DocumentMetadata} command tells \LaTeX{} that you opt in
to new and rewritten behaviors.
For example, it enables some new features in the \pkg[opt-in features]{hyperref} package.

\begin{latexthree}
This work is still heavily in progress.
There are some arguments to \cmd{DocumentMetadata} that enable further in-development features.
As of April~2024 these include tagging of mathematics and tables.

Since these arguments are unstable, they are not documented here
and should not be used in ``real'' documents quite yet.
You can follow the progress through \LaTeX{} release newsletters:
\begin{quote}
\url{https://www.latex-project.org/news/}
\end{quote}
\end{latexthree}

In order for the tagging to work,
you need to produce semantically correct code.
That is, use \verb|\subsection*| when you need an unnumbered subsection,
and only then -- do not abuse it for bold, heavy text.
Similarly, use \verb|\emph| to emphasize,
instead of \verb|\textit| or \verb|\textbf| that carry only visual meaning.


%
%
\subsection{HTML conversion}

Another option is to skip PDF altogether.
The most common alternative format is HTML, the technology behind web pages.
It has a few benefits:
%
\begin{itemize}
\item It is processed on the user device, so e.g.\ colours can be customized by the reader.
\item The text can be reflowed based on the screen size and magnification factor.
\item Existing screen reader programs can already read out web pages.
\end{itemize}
%
However, there are a few drawbacks too:
%
\begin{itemize}
\item \TeX{} is built on the model of printing on paper; it assumes a fixed layout in many places.
\item The usual \LaTeX{} compilers only produce PDF output or equivalent.
\end{itemize}

The HTML approach is now pursued by several publishers and arXiv,
together with e.g.\ American Mathematical Society.
ArXiv uses a tool called \mbox{LaTeXML}%
\footnote{\url{https://github.com/brucemiller/LaTeXML}}
that is essentially a new \TeX{} compiler that selectively reimplements some packages.

Since \LaTeX{} is already semantically focused, this works surprisingly well.
A lot of packages are already supported.
Importantly, TikZ can output its pictures also in the SVG (Scalable Vector Graphics) format
used together with HTML.\index{TikZ!accessibility}

\begin{practices}
Load and use only the packages that you really need.
Prefer mainstream packages supported by the arXiv converter.
ArXiv has a help document outlining some more best practices for HTML conversion.\footnotemark
\end{practices}
\footnotetext{\url{https://info.arxiv.org/help/submit_latex_best_practices.html}}



%
%
\subsection{Accessible source code}

Both of the above methods require you to use semantically meaningful commands:
otherwise, the automated tools are unable to do tagging/conversion.
Yet writing good semantic \LaTeX{} code is also an accessibility feature:
you can always read the source code.

\begin{remark}
Source code posted to arXiv is public and downloadable.
\end{remark}

If you want to set vectors in bold font, then do not write \verb|\mathbf| but
redefine \verb|\vec| to set vectors in bold style:
%
\begin{VerbatimOut}{\jobname.tmp}
% Preamble
\renewcommand{\vec}{\mathbf}

$\vec a$
\end{VerbatimOut}
\ShowExample
%
Now it is immediate from the source code that \verb|a| refers to a vector.
It can not be confused with other things marked with boldface.
Besides, if you change your mind about the style,
you only need to change one command in the preamble.


%
%
%
\section{Typefaces}\label{sec:typefaces}

\todo{Point sizes}
\todo{Microtypography}

\todo{Palatino and Noto with math}

\subsection{Emoji}\label{sec:emoji}

Emoji are Unicode characters, so in principle they can be included just as is in the source code.
The problem is choosing a font that can display the characters.

The \pkg{emoji} package automatically chooses an available emoji font
(that is, the output will depend on your operating system!).
It only works with recent LuaTeX (2020 or newer).
The command provides readable shorthand names for the characters (listed in documentation):
%
\begin{ExampleCode}
% Preamble
\usepackage{emoji}

% In text
\emoji{thinking-face}
\end{ExampleCode}

There is also the manual way of loading the emoji font with \pkg[emoji]{fontspec}:
%
\begin{ExampleCode}
% Preamble
\usepackage{fontspec}
\newfontfamily{\emojifont}{Noto Color Emoji}[Renderer=Harfbuzz]

% In text
{\emojifont ...}
\end{ExampleCode}
%
Here, \verb|...| should be replaced with the emoji
(not displayed here, since these notes do not have an emoji font set up!).
You need to install the emoji font or replace it by the system emoji font.
(On Windows, it is called \texttt{Segoe UI Emoji};
on macOS it is \texttt{Apple Color Emoji}.)

\begin{overleaf}
The Overleaf editor cannot handle the Unicode emoji characters as of May~2024.
If you use Overleaf, you need to use the \pkg{emoji} package.
\end{overleaf}

\begin{warning}
With the manual way, black-and-white emoji can be displayed by both XeTeX and LuaTeX,
but color emoji requires LuaTeX with the HarfBuzz renderer.
If you use \pkg[emoji]{fontspec} to load an emoji font,
you need to pass \verb|Renderer=Harfbuzz| as an optional font feature.
This option is effective only with LuaTeX.
\end{warning}

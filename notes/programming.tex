% !TeX root = 2nd-course-in-latex.tex
% (The appearance of \documentclass in the examples confuses LaTeX Workshop for VS Code)

\chapter{Programming}

What really is \LaTeX?

It all starts with \TeX, the typesetting system designed by Donald Knuth in late 70s and 80s.
\TeX{} is a powerful system for laying out text,
but it puts a lot of responsibility on the writer.
Essentially, you are responsible for both the content and its presentation.

\LaTeX{} (originally by Leslie Lamport, now maintained by several people)
extends this core by introducing commands like \cmd{section}:
this command not only lays out the section title in a bigger font,
but also adds some vertical whitespace around it, updates the current section number,
adds an entry to the table of contents, and so on.
This \emph{separates the content from how it is presented}.

We will try to emphasize this philosophy on this course.
By using standard constructs, packages, and our own custom commands,
we can make the \verb|.tex| source code \emph{semantically} meaningful:
something that you could read aloud.
The system then makes sure that the output looks great on paper
-- isn't that why we ever wanted computers to exist!


\begin{warning}
Even when using \LaTeX{}, the old \TeX{} is still there.
It is possible to use plain-\TeX{} commands in your documents,
but \emph{this is highly discouraged}.
These commands sidestep all the enhancements brought by \LaTeX,
and might cause hard-to-diagnose problems.
You might need them when writing more complicated packages,
but then you are already solidly in the ``you are free to shoot your own foot'' territory.
Some such commands are noted in these Warnings.

Unfortunately, many heritage templates and Stack Exchange answers still mix
\TeX{}, \LaTeX, and pre-1994 \LaTeX.
Examples of the latter include the obsolete \obscmd{bf} and \obscmd{it} commands
(e.g.\ writing \verb|{\bf bold}| instead of \verb|\textbf{bold}|).
\end{warning}


\begin{latexthree}
The ``standard'' \LaTeX{} version is $2\varepsilon$, released in 1994.
\LaTeX3 is a long-running project (started already before $2\varepsilon$, and reactivated around 2018)
on rewriting the internals of \LaTeX{} to be more extensible.

\LaTeX3 introduces new commands for defining commands and environments.
We will only discuss the version $2\varepsilon$ methods (which are still valid) here,
but if you find yourself writing a package, you should consider learning about the new methods.

We will talk about some new features and accessibility improvements brought by \LaTeX3 below,
starting already in \Cref{sec:document structure}.
\end{latexthree}



%
%
%
\section{How \LaTeX{} processes files}

\todo{Write this}

\todo{Maybe introduce \texttt{input} here}



%
%
%
\section{Commands and environments}

\begin{practices}
When should you define your own commands?
Generally, the less customization you have,
the easier your manuscript is for the journal publication process and your coauthors.
At the same time, good commands make the code semantically meaningful.

I personally find \verb&\norm{...}& easier to read than \verb&\left\|...\right\|&,
and \verb|\Prob| certainly better than \verb|\mathbb P|,
but others could find those an overkill.
This is a hard balance to strike.

There is just one strict rule:
never repurpose the name of an existing base \LaTeX{} command.
It will cause endless trouble when some part of the journal style tries to use the original command.
\end{practices}


\subsection{Defining commands}
\index{macros}
\TeX{} is a macro language.
This means that there are special source code tokens (\emph{macros}),
that are \emph{expanded} into sequences of more tokens
(including more macros, which are expanded recursively).
The core system includes only a few commands for manipulating internal state and putting out text,
and the rest is achieved via macro expansion.

That was a mouthful, so let us see an example.
In \LaTeX{} macros are defined with the \cmd{newcommand} command.

\begin{VerbatimOut}{\jobname.tmp}
\newcommand{\hello}{Hello world!}

\hello
\end{VerbatimOut}
\ShowExample

Here \cmd{newcommand} takes two arguments:
the first is the name of the macro to define, and the second is what the macro expands to.
In \TeX{} things are grouped with the \verb|{}| braces.
(The first set of braces is technically unnecessary, but it looks cleaner in my opinion.)

Let us see another example where the command is used repeatedly,
and also expanded inside other commands:
\indexcmd{MakeUppercase}
\begin{VerbatimOut}{\jobname.tmp}
\newcommand{\hello}{Hello world}

--\hello, they whispered.\\
--I said, \MakeUppercase{\hello}!
\end{VerbatimOut}
\ShowExample

Since the macros are expanded recursively until there is nothing more to expand,
you can write things that are semantically very unclear,
but comprehensible to a computer:
\begin{VerbatimOut}{\jobname.tmp}
\newcommand{\hi}{^\infty}
\newcommand{\underscore}{_}
\newcommand{\lo}{\underscore{i=1}}

\[ \sum\lo\hi \]
\end{VerbatimOut}
\ShowExample
%
The expansion goes something like this:
\begin{enumerate}
    \item \verb|\sum\lo\hi|
    \item \verb|\sum\underscore{i=1}\hi|
    \item \verb|\sum_{i=1}\hi|
    \item \verb|\sum_{i=1}^\infty|
\end{enumerate}
So the end result is the same as if one had written the sum sensibly from the beginning.



\begin{warning}
In plain \TeX{} macros are defined with \obscmd{def} and \obscmd{let}.
If you see code using either,
you have entered the ``shoot your own foot'' territory.\footnotemark
\end{warning}
\footnotetext{Since you asked, the difference between the two is whether the contents of the macro
are expanded at usage or definition time.
Neither protects you against overwriting existing macros.}
\quiettodo{Keep these on the same page!}


%
\subsection{Arguments to commands}

To pass arguments to macros, we can indicate their number with an optional argument
between the macro name and definition.
These arguments can then be accessed in the macro definition with \verb|#1|, \verb|#2|, and so on.

\begin{VerbatimOut}{\jobname.tmp}
\newcommand{\say}[2]{#1 says ``#2''!}

\say{Petri}{Hi}
\end{VerbatimOut}
\ShowExample

Arguments are often wrapped in the \verb|{}| braces,
but it is not actually necessary -- in a very specific case.
By default, \LaTeX{} interprets a single letter or a number as an argument.
The braces extend the argument to a longer stretch.

This means that all of the following are equivalent:

\begin{VerbatimOut}{\jobname.tmp}
\[
\frac{1}{2}
= \frac 1 2
= \frac12.
\]
\end{VerbatimOut}
\ShowExample

Do note the last one -- \LaTeX{} command names can only consist of letters,
so the number 1 is not interpreted as part of the command name but an argument.
There is no requirement to separate the name and a following number.
(I do find the last example hard to read, though.)
Conversely, whitespace won't separate longer arguments; you really need the braces:

\begin{VerbatimOut}{\jobname.tmp}
\[
\frac 12 34
\neq \frac {12} {34}.
\]
\end{VerbatimOut}
\ShowExample

However, commands are interpreted as single tokens.
This happens regardless of whether the command would expand to several tokens.

\begin{VerbatimOut}{\jobname.tmp}
\newcommand{\magic}{314 159}
\[ \frac \magic \pi \]
\end{VerbatimOut}
\ShowExample

\begin{gotcha}
Some built-in macros swallow the whitespace that follows them.
If a word space is actually needed, you can feed the command an empty group \verb|{}|:
\begin{VerbatimOut}{\jobname.tmp}
\LaTeX programming\\
\LaTeX{} programming
\end{VerbatimOut}
\ShowExample
\end{gotcha}


%
\subsection{Groups and scopes}

\index{group}\index{scope}
\label{ex:font scope}
More precisely, the braces delimit a \emph{group}.
A group is handled as a single argument to a command.
Additionally, they serve as a \emph{scope} for commands that change
how all the following text is output.
For example, the font-sizing commands like \cmd{tiny} and \cmd{Large}
affect the size of all text that follows them.
However, this effect only lasts until the group is closed with a \verb|}|.

\begin{VerbatimOut}{\jobname.tmp}
{\tiny I am small}
and I am normal
and {\Large I am large}
\end{VerbatimOut}
\ShowExample

If you forget about this and just write \cmd{tiny} without any scoping,
you will have tiny text until the end of document (or the next font size command).

\begin{VerbatimOut}{\jobname.tmp}
\tiny I am small and
{\Large I am large}
and I am tiny again
\end{VerbatimOut}
\ShowExample

There is one place where the braces do not delimit a group:
in the definition of commands.
In the following example, \verb|\mouse{Squeak}| is expanded into
\verb|\tiny Squeak| and not into \verb|{\tiny Squeak}|.
Therefore the effect persists onto the following line.
%
\begin{VerbatimOut}{\jobname.tmp}
\newcommand{\mouse}[1]{Mouse: \tiny#1.}

\mouse{Squeak}\\
I: Oops.
\end{VerbatimOut}
\ShowExample
%
The scope can be introduced here by adding \verb|{}| into the command definition:
%
\begin{VerbatimOut}{\jobname.tmp}
\newcommand{\mouse}[1]{{Mouse: \tiny#1.}}

\mouse{Squeak}\\
I: Alright.
\end{VerbatimOut}
\ShowExample

Scopes also affect things like \cmd[scope]{newcommand}:
the command \verb|\mouse| defined above only exists
within the example block, and is not accessible beyond it.



%
\subsection{Optional arguments}

Some commands also have optional arguments.
Instead of braces, these are passed within brackets \verb|[]|.
A basic example is the \cmd{sqrt} command
that produces not only square roots, but general roots:
\begin{VerbatimOut}{\jobname.tmp}
$\sqrt{7}$,
$\sqrt[3]{7}$.
\end{VerbatimOut}
\ShowExample

Another example is the optional argument to \cmd{cite} command,
which indicates a precise position within the cited work:
\verb|\cite[Page 40]{TLC}| produces \cite[Page 40]{TLC}.
(Here \verb|TLC| is the bibliography key for \emph{The \LaTeX{} Companion};
we will discuss this more in \Cref{sec:bibliography})

\begin{gotcha}
Inside an optional argument, \LaTeX{} interprets the first \verb|]| it sees as the closing bracket.
This means that if you need to use \verb|[]| \emph{inside} an optional argument
(say, as an optional argument to an inner command), you need to wrap things in braces.
Quite often, you might need even \emph{two sets of braces}.
Compare the two citations:
%
\begin{VerbatimOut}{\jobname.tmp}
\cite[{{Page [40] maybe?}}]{TLC}\\
\cite[Page [40] maybe?]{TLC}
\end{VerbatimOut}
\ShowExample
%
The first citation is shown correctly.
In the second, the optional argument is interpreted to be ``\verb|Page [40|''
and the citation name then ``\verb|m|'' (only a single letter since it was not wrapped in braces).
The remaining ``\verb|aybe?]{TLC}|'' is then normal body text.
\end{gotcha}

\begin{gotcha}
\LaTeX{} ignores whitespace between a command and its optional argument.
This might sometimes lead to surprising behaviour.
Here the second list item is interpreted as an optional argument that replaces the bullet symbol:
\indexcmd{item}
%
\begin{VerbatimOut}{\jobname.tmp}
\begin{itemize}
\item Cookies
\item [Maybe cake?]
\item Drinks
\end{itemize}
\end{VerbatimOut}
\ShowExample
\end{gotcha}


The syntax for optional arguments is not always clear:
sometimes they precede the real arguments, sometimes they follow them.
Sometimes they consist of just one thing,
sometimes they can be a list of things
(see the discussion of \cmd{usepackage} later in this chapter).

\todo{Defining commands with optional arguments?}


%
\subsection{Replacing existing commands}

Sometimes it is useful to overwrite an existing command.
One common example is rewriting \cmd{epsilon} to actually mean \cmd{varepsilon},
since many consider the variant $\varepsilon$ prettier than the regular $\epsilon$.

It is not possible to write \verb|\newcommand{\epsilon}{\varepsilon}|,
since \LaTeX{} rightly complains about \verb|\epsilon| being already defined.
You could be accidentally overwriting a command used elsewhere in the document.
You have to make your intentions clear by using \cmd{renewcommand}:

\begin{VerbatimOut}{\jobname.tmp}
Old epsilon: $\epsilon$,\\
\renewcommand{\epsilon}{\varepsilon}
New epsilon: $\epsilon$.
\end{VerbatimOut}
\ShowExample
%
Again, the redefinition of a command lasts only for the current scope.
Once the scope is closed, \verb|\epsilon| again means the old regular symbol.
To redefine a command within the entire document,
you need to call \cmd{renewcommand} in the document preamble.

Here is an example of \cmd{newcommand} and \cmd{renewcommand} with arguments.
The two commands have matching syntax.
Note that the new definition is free to have a different number of arguments.

\begin{VerbatimOut}{\jobname.tmp}
\newcommand{\dual}[2]{(#1 \mid #2)}
Mathematicians: $\dual{a}{b}$.\\
\renewcommand{\dual}[2]
  {\langle#2 \mid #1\rangle}
Physicists: $\dual{a}{b}$.
\end{VerbatimOut}
\ShowExample


\todo{Advanced: adding to an existing command.}


%
\subsection{Defining environments}

\index{environments}
Environments encapsulate larger blocks of text.
They also form implicit groups.

\begin{VerbatimOut}{\jobname.tmp}
\begin{center}
\renewcommand{\epsilon}{\varepsilon}
Centered text and $\epsilon$
\end{center}

\begin{flushright}
Right-aligned text.
Here we have the old $\epsilon$.
\end{flushright}
\end{VerbatimOut}
\ShowExample

To define an environment, we use the \cmd{newenvironment} command.
This command takes three arguments: the name of the environment
and code to expand at the beginning and the end of the environment.

\begin{VerbatimOut}{\jobname.tmp}
\newenvironment{cool}
    {A mathmo enters the lab.\par}
    {\par The mathmo leaves the lab.}

\begin{cool}
A massive explosion occurs.
\end{cool}
\end{VerbatimOut}
\ShowExample
%
(If you're wondering about the \cmd{par} commands,
they are used to ensure that the first and last lines are their own paragraphs.)

There is also \cmd{renewenvironment} that works like \verb|\renewcommand|.

Since environments are groups,
it is possible to change font characteristics for the duration of the environment:

\begin{VerbatimOut}{\jobname.tmp}
\newenvironment{mouse}{\tiny}{}

Ordinary text.
\begin{mouse}
Very small and very squeaky text.
\end{mouse}
Again ordinary text.
\end{VerbatimOut}
\ShowExample
%
Note that here the end code is empty;
the font properties are reset automatically as the group ends.

\begin{gotcha}
If the begin/end code of your environment spans multiple lines,
you need to be careful with line breaks.
The extra whitespace might cause \LaTeX{} to output an unintended empty space
or even a paragraph break.
To avoid line breaks to be interpreted as line breaks,
you can end each line in the environment definition with \verb|%|
-- the comment character shallows the line break.

This same thing applies to empty lines before and after environment usage
-- the usual paragraph-breaking rules apply.
If you don't want to start a new paragraph after the environment ends,
do not leave an empty line between \verb|\end{...}| and the following text.
(For visual separation in the code, I prefer a line containing just \verb|%|.)
\end{gotcha}



\todo{Parameter form; improvements in L3}


%
%
%
\section{Diagnosing errors}

Macro languages were popular in the 1980s, back when 640 kilobytes was enough memory for anyone.
An unfortunate consequence of \TeX's stability is that the compiler still operates under this worldview.
The source code is read exactly once from top to bottom,
and if the code is not correct, error messages can be extremely cryptic.

\begin{overleaf}
Some \LaTeX{} distributions are set up to ignore some errors.
For example, Overleaf is quite good at ignoring missing \verb|$| signs and other small typos.
You should really pay attention to red symbols in the source code margin
and next to the \emph{Recompile} button!
\end{overleaf}

The compiler gives three forms of output: information, warnings and errors.
Graphical \LaTeX{} editors usually only show the latter two.
(Information is printed in the console output.
It includes the current source file and page number that the compiler is processing,
which can help diagnose a stuck compilation.)

\index{warnings}
Warnings are just as the name says: the document can still be compiled,
but you should check whether you have gotten what you intended.
Generally, the warning messages are very descriptive:

\medskip\noindent\emph{Overfull or underfull hbox.}\\*
A line could not be breaked in a nice way.
See \Cref{sec:overfull} for how to solve this.

\medskip\noindent\emph{Citation or label undefined.}\\*
\LaTeX{} could not recognize a label that you tried to reference.
If the label or bibliography entry was newly added, a recompilation might fix this.
Otherwise you have forgotten to define it at all, or just forgotten how to spell it.
See \Cref{sec:crossref,sec:bibliography}.

\medskip\noindent\emph{Label(s) may have changed. Rerun to get cross-references right.}\\*
Indeed, you have added a new label since the last compilation.
Just recompile the file.

\medskip\noindent\emph{Temporary extra page added at the end. Rerun to get it removed.}\\*
This can happen if the document becomes shorter than in the last compilation.
\LaTeX{} tries to place the processing that happens at \verb|\end{document}|
to the final page, but it does not know the final number of pages until it is too late
(hence it looks at the previous compilation for a hint).
As the message says, there is an extra page explaining the issue at the end.
Recompile and it goes away.


\begin{practices}
You should always check for warnings before submitting a document.
It's a bit embarrassing to publish a document with [\textbf{?}] citations, after all.

Overfull and underfull hboxes are usually \emph{not worth fixing}
until the final typesetting phase,
since very small changes to the text or style can drastically change the line breaking.
\end{practices}


\index{errors}
Errors, on the other hand, halt the compiler altogether.
The compiler can try to ignore errors and recover itself,
but at that point \emph{it is guessing} what you tried to mean,
and might get even more confused.
Quite often the internal state is so messed up, \TeX{} can only spew more errors.


\begin{practices}
Recompile often.
It is much easier to locate an error when you have modified only a small region of the code.

Always recompile after you modify a command definition
or do a find-and-replace operation.
These are risky.

If your document takes a long time to compile,
find a way to speed it up
(skip complicated TikZ pictures in draft mode, comment out chapters you're not working on, etc.).
If recompilation breaks your flow, you won't do it often enough.

\todo{Practical way to do the TikZ trick.}
\end{practices}


\medskip\noindent\emph{[100+ error messages]}\\*
Did you just modify the definition of a command?
If so, then you probably introduced a typo there.

If not, this is a strong sign that \TeX{} failed to recover from an error.
Scroll to the \emph{very first} error message and fix it.
The later error messages are misleading,
and will go away once the actual error is fixed.

\todo{Common error messages}



%
%
%
\section{Document structure}\label{sec:document structure}

Let us then look at the basic structure of a \verb|.tex| file.
Everyone reading these notes is assumed to have seen such a file more than once,
but we will spend some time on some nuances.
Bear with me even if this sounds trivial!

\begin{practices}
I would advocate for starting every project from an empty \verb|.tex| file.
The problem with ``heritage'' templates is that they accumulate a lot
of unnecessary package dependencies and custom commands.
I've seen files where the same package is loaded three times.

By starting from an empty file
and only adding the customizations you need for the particular project,
you help maintain your ``code hygiene''.
\end{practices}

Let us start with the minimal example below.

\begin{ExampleCode}[numbers=left]
\DocumentMetadata{}
\documentclass[a4paper]{article}

\usepackage[hidelinks]{hyperref}

\title{My first document}
\author{Firstname Lastname}
\date{\today}

\begin{document}

\maketitle

% Rest of content here...

\end{document}
\end{ExampleCode}

We discuss the first line in a \LaTeX3 note below.
On the second line, we load a \LaTeX{} document class.
The document class determines the basic layout of your document,
and it is where several basic commands like \cmd{maketitle} are defined.
We will look at some different document classes and arguments in the next subsection.

Lines 1--9 are collectively known as the \emph{preamble}.\index{preamble}
This is the best place to define new commands and do other setup.
Additional packages are also loaded here; see \Cref{sec:loading packages}.

\begin{latexthree}
What's interesting in the above example is the one package that is \emph{not} loaded.
The \pkg{inputenc} package used to be very important to load,
since it told \LaTeX{} about the encoding of non-English characters.
Since 2018 \LaTeX{} has followed the rest of the world
and uses UTF-8 encoding by default.

What does this mean for you?
If you create a new file in any reasonably modern \LaTeX{} editor,
you get the correct encoding and don't need to load \pkg{inputenc}.

However, if you modify a sufficiently aged file that contains non-English characters,
you might stumble upon legacy encodings like \texttt{latin1} or \texttt{cp1252}.
In such files, the \pkg{inputenc} package must be loaded with the proper optional argument.
\end{latexthree}

\todo{Font encoding, reference to coming section}


Trying to output any text before the \verb|\begin{document}| line is an error.
\indexenv{document}%
When the compiler reaches that line,
a lot of stuff happens behind the scenes to prepare \LaTeX{} for actually outputting pages.

Similarly, the \verb|\end{document}| line is necessary.
At that point, a lot of code is executed to make sure that everything is output properly.
Any text written below that line is ignored.
(I do not recommend writing anything there!)

\begin{latexthree}
An important part of the \LaTeX3 project is revising the PDF output
to include accessibility information:
for example, tagging section headings as headings and not just bold text in big font.
Since this might cause issues with some packages, the new behaviour is opt-in.

If you write \indexcmd{DocumentMetadata}\verb|\DocumentMetadata{}|
before the \verb|\documentclass| declaration, you opt in to these new features.
This command also enables new functionality in e.g.\ the \pkg{hyperref} package.
\end{latexthree}


%
\subsection{Document classes}\label{sec:document classes}

\begin{practices}
Journals commonly define their own document classes, based on one of the standard classes.
The discussion below only applies to the documents where you are in charge of the style.
Always look at the journal instructions for preparing the published version of your article.
\end{practices}

\index{document classes}
There are three document classes of interest included in base \LaTeX{}:

\begin{description}
\item[article] As the name suggests, this should be used for articles, short notes, and such.
    The \cmd{maketitle} command does not create a separate title page,
    and the highest-level sectioning command is \cmd{section}.
    There is no page break between sections.
\item[report] This class is suitable for e.g.\ a thesis, lecture notes, or a longer article.
    The present notes use this class.
    There is a separate title page,
    and the highest-level sectioning command is \cmd{chapter}.
    Each chapter begins on a new page.
\item[book] This is the heaviest of all the classes.
    You get a lot of empty pages, just like in a real printed book.
    If you find yourself using this class,
    you have agreed to something monumental.
\end{description}
%
There is also a \textbf{letter} document class,
which understandably sees little use nowadays.
But it is still there if you need it!

Options passed to document classes are interesting in that
\emph{they are also passed to all packages}.
If you pass \verb|a4paper| to the document class,
then you don't need to pass it again to the \pkg{geometry} package.

Some options are supported by all the basic document classes:

\begin{description}
\item[a4paper] This is self-explanatory.
    By default, \LaTeX{} assumes the American letter paper size.
\item[a5paper] At least University of Helsinki uses A5 as the thesis format.
\item[10pt, 11pt, 12pt] Sets the body font size.
    Fonts for section headers, footnotes, etc.\ are scaled accordingly.
    The default is 10~points.
\item[oneside, twoside] Whether the margins are equal
    or alternating between odd and even pages.
    For example this document (which is aimed for consuption on a screen)
    uses \verb|oneside|, but a printed report should specify \verb|twoside|.
\item[openright, openany]
    Whether chapters always begin on a right-hand side page (default for book)
    or any page (default for report).
    You should consider \verb|openright| for a printed thesis.
    Not applicable to the article class where chapters are not supported at all.
\item[notitlepage, titlepage] Whether the title is set on a separate page.
\item[fleqn] Instead of centering, left-aligns display formulas.
\item[twocolumn] Sets the text in two columns.
\end{description}


A very common alternative document class is \textbf{amsart}.\indexpkg{amsart}
It is developed by the American Mathematical Society,
and some prefer its style to that of \textbf{article}.
It is a drop-in replacement for \textbf{article} and supports the same options.

Other common classes include those from \pkg{koma-script}
(drop-in replacements for all standard classes)
and \pkg{memoir} (intended for longer documents),
which both provide a lot of flexibility.
They both come with extensive documentation for those who wish to venture into that rabbit hole.


%
\subsection{Loading packages}\label{sec:loading packages}

In the previous example, we loaded the \pkg{hyperref} package with:
\begin{ExampleCode}
\usepackage[hidelinks]{hyperref}
\end{ExampleCode}
Options can be passed to packages inside the brackets.
Here we pass the \verb|hidelinks| option that suppresses the coloured boxes around clickable links.
Some packages also take options with a \verb|key=value| notation.

In addition to the options passed explicitly,
all the options passed to the document class are also forwarded to the package.

\begin{practices}
You should always load \pkg{hyperref}.
It not only turns cross-references into clickable links,
but also adds section headers to the PDF table of contents
(usually found in the sidebar of any reader application).
Your readers will appreciate this navigation aid.
\end{practices}

\index{packages!finding}
CTAN, the \emph{Comprehensive \TeX{} Archive Network},
is the repository for \LaTeX{} packages.
It can be browsed at \url{www.ctan.org}.

Generally \LaTeX{} distributions either contain the whole CTAN,
or are able to download packages from there as needed.
You should check out how you can keep your distribution up to date,
as new versions of packages are continually released.

Most importantly, all major packages listed on CTAN have good documentation there.
The documentation typically includes usage examples, a complete reference,
and possible compatibility issues with other packages.
For example, you can find the (very extensive!) documentation of \pkg{hyperref}
at \url{www.ctan.org/pkg/hyperref}.

\todo{Other common packages}
\begin{description}
\item[xcolor] Support for setting text and symbols in colour.
    Replaces the old \obspkg{color} package included in early nineties \LaTeX{};
    do not confuse the two.
    See \Cref{sec:colour}.
\end{description}


\begin{gotcha}\index{packages!loading order}
Quite a few packages modify the standard \LaTeX{} commands
and even the commands defined by each other.
This means that sometimes it is important to load packages in the correct order,
so that the modifications are applied sensibly.
The core packages are usually compatible with each other,
but you should always check the package documentation for possible conflicts.

For example, it is important to load \pkg{ntheorem} before \pkg{hyperref},
since the former modifies the label commands that are also touched by the latter.
Otherwise, you might get non-functioning hyperlinks.
\end{gotcha}



\section{Creating your own style file}



%
%
%
\section{Counters}

\LaTeX{} keeps a lot of internal state in variables called \emph{counters}\index{counters}.

\begin{VerbatimOut}{\jobname.tmp}
We are in Chapter~\arabic{chapter}
and its Section~\arabic{section}.

\begin{enumerate}
\item This is item~\arabic{enumi}.
\item This is item~\arabic{enumi}.
  \begin{enumerate}
  \item Subitem~\arabic{enumii}.
  \item Subitem~\arabic{enumii}.
  \end{enumerate}
\end{enumerate}
\end{VerbatimOut}
\ShowExample

The counters seen in the above example are automatically stepped by the sectioning and list commands.
They can be manually manipulated with the \cmd{setcounter} command.
One such example is seen in Väisälä's topology textbook:

\begin{ExampleCode}
\setcounter{chapter}{-1}
\chapter{Prerequisites}

% The chapter name is printed as "0. Prerequisites"
% Note: the counter is set to -1 to compensate for \chapter stepping it
\end{ExampleCode}

It is also possible to add/subtract a value to a counter:
\indexcmd{stepcounter}\indexcmd{addtocounter}%
\begin{VerbatimOut}{\jobname.tmp}
\begin{enumerate}
\item Add one and step:
  \stepcounter{enumi}
\item Add seven and step:
  \addtocounter{enumi}{7}
\item Minus one + step:
  \addtocounter{enumi}{-1}
\item Same as above!
\end{enumerate}
\end{VerbatimOut}
\ShowExample

There are many ways to output the value of a counter:\index{counters!displaying}
%
\begin{VerbatimOut}{\jobname.tmp}
Section~\arabic{section}\\
Section~\alph{section}\\
Section~\Alph{section}\\
Section~\Roman{section}\\
Section~\fnsymbol{section}
\end{VerbatimOut}
\ShowExample
The last command \verb|\fnsymbol| is used for footnote symbols.
Note that the letter-based styles can be capitalized
by using \verb|\Roman| instead of \verb|\roman| etc.

To define your own counters, you can use \cmd{newcounter}:
\index{counters!defining}%
%
\begin{VerbatimOut}{\jobname.tmp}
\newcounter{fact}
\newcommand{\axiom}[1]{\stepcounter{fact}%
    \textbf{Rule \arabic{fact}.} #1\par}

\axiom{Don't use plain \TeX.}
\axiom{See the above.}
\end{VerbatimOut}
\ShowExample

If you want the counter to reset when another counter is stepped,
you can pass an optional argument (\emph{after} the counter name!) to \cmd{newcounter}.
An example use case is to reset the counter every time a new section is started
(in which case the optional argument would be \verb|[section]|):
%
\begin{VerbatimOut}{\jobname.tmp}
\setcounter{fact}{0}
\newcommand{\axiom}[1]{\stepcounter{fact}%
    \textbf{Rule \arabic{fact}.} #1\par}
\newcounter{exc}[fact]
\newcommand{\except}[1]{\stepcounter{exc}%
  {\tiny Exception~\roman{exc}. #1}\par}

\axiom{Don't use plain \TeX.}
\except{Unless Don Knuth passes by.}
\except{Or you're a masochist.}
\axiom{See the above.}
\except{No exceptions.}
\end{VerbatimOut}
\ShowExample[4]

\begin{gotcha}
This only sees the effect of \verb|\stepcounter| on the another counter;
if you use \verb|\setcounter| to change it, the dependent counter is not reset.
\end{gotcha}

\begin{technote}
Counters are always in a global scope.\index{scope!counters}
That is, the definition of a counter does not disappear as the group is closed.
If you would like to use the same counter name again in a later context,
you can (or rather, must) reset and reuse the previous counter.

Due to this, you should probably define your counters in the preamble.
\end{technote}


%
%
%
\section{\emph{Further topics*}}

\todo{Say something about robustness}

\todo{ifthen, loops, ?}

\todo{Adding options to own packages}


